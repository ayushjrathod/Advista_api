generator client {
  provider = "prisma-client-py"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id                  String    @id @default(uuid())
  email               String    @unique
  password            String
  firebaseUid         String?   @unique
  verifyCode          String?
  isVerified          Boolean   @default(false)
  verifyCodeExpiresAt DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt

  @@map("users")
}

model ChatSession {
  threadId         String            @id @default(uuid())
  userId           String?
  researchBrief    String?
  status           ChatSessionStatus @default(initialized)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  lastActivity     DateTime?
  expiresAt        DateTime?
  meta             Json?
  researchSessions ResearchSession[]

  @@map("chat_sessions")
}

model ResearchSession {
  id               String                @id @default(uuid())
  threadId         String
  userId           String?
  researchBrief    Json?
  status           ResearchSessionStatus @default(pending)
  taskIds          Json?
  searchParams     Json?
  searchResults    Json?
  processedResults Json?
  report           Json?
  meta             Json?
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  completedAt      DateTime?
  chatSession      ChatSession           @relation(fields: [threadId], references: [threadId], onDelete: Cascade)

  @@map("research_sessions")
}

enum ChatSessionStatus {
  initialized
  brief_generated
}

enum ResearchSessionStatus {
  pending
  researching
  processing
  synthesizing
  completed
  failed
}
